---
title: "p8105_hw3_af3341"
author: "Alana Ferris"
date: "2022-10-07"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, message = FALSE, warning = FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)
library(dplyr)
library(ggplot2)
```

# Problem 1

```{r}
library(p8105.datasets)
data("instacart")
```

## Dataset Description

The `instacart` dataset contains `r nrow(instacart)` observations of individual products from different instacart orders. There are `r ncol(instacart)` total variables in this dataset describing order information, product information, and customer information, which are listed below. For example, in observation row 1027, the customer ordered concentrated homestyle chicken stock which we can also see they have never ordered before because of the value of 0 in the `reordered` column. We also know this item was found in the canned goods department in aisle 69. One could keep reading the values in the different columns for more information on this product. 

* `order_id`: order identifier
* `product_id`: product identifier
* `add_to_cart_order`: order in which each product was added to cart
* `reordered`: 1 if this product has been ordered by this user in the past, 0 otherwise
* `user_id`: customer identifier
* `eval_set`: which evaluation set this order belongs in
* `order_number`: the order sequence number for this user (1=first, n=nth)
* `order_dow`: the day of the week on which the order was placed
* `order_hour_of_day`: the hour of the day on which the order was placed
* `days_since_prior_order`: days since the last order, capped at 30, NA if order_number=1
* `product_name`: name of the product
* `aisle_id`: aisle identifier
* `department_id`: department identifier
* `aisle`: the name of the aisle
* `department`: the name of the department

## Questions

### How many aisles are there and which aisles are the most items ordered from?
```{r, warning = FALSE, message = FALSE}
distinct_aisle_df = instacart %>% 
  group_by(aisle, aisle_id) %>% 
  distinct() %>% 
  summarize(
    n_obs = n()
  )
```

There are 134 aisles, of which `aisle_id` 83 and 24 (fresh vegetables and fresh fruits respectively) are the most ordered from. They both have over 150,000 orders each.

### Plot of number of items ordered in each aisle

```{r, message = FALSE, warning = FALSE}
grouped = instacart %>% 
  group_by(aisle) %>% 
  summarize(aisle_count = n()) %>% 
  filter(aisle_count > 10000)

  ggplot(grouped, aes(x = (reorder(aisle, aisle_count)), y = aisle_count)) +
    geom_bar(stat = "identity") + 
      labs(
    x = "Aisle",
    y = "Number of Items Purchased",
    title = "Barplot of the most popular Instacart aisles") + 
    viridis::scale_color_viridis(
    name = "Aisle", 
    discrete = TRUE) + 
    coord_flip()
```
### Table for three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”

```{r, warning = FALSE}
three_aisles = instacart %>% 
  group_by(aisle, product_name) %>% 
  summarize(aisle_count = n()) %>% 
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits") %>% 
  arrange(desc(aisle_count)) %>% 
  slice(1:3)

three_aisles
```

### Table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered

```{r, message = FALSE, warning = FALSE}
mean_hour = instacart %>% 
  group_by(product_name, order_dow, order_hour_of_day) %>% 
  mutate(order_dow = recode(order_dow, `0` = "Sunday", `1` = "Monday", `2` = "Tuesday", `3` = "Wednesday", `4` = "Thursday", `5` = "Friday", `6` = "Saturday")) %>% 
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") %>% 
  select(product_name, order_dow, order_hour_of_day) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(mean_hour_of_day = mean(order_hour_of_day, na.rm = TRUE)) %>% 
  pivot_wider(
    names_from = "order_dow",
    values_from = "mean_hour_of_day"
  ) %>% 
  select(Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday)

mean_hour
```


